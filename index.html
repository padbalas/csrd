<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CarbonWise | TurboTax for Carbon Reporting</title>
  <style>
    :root {
      --ink: #0f172a;
      --muted: #4b5563;
      --line: #e5e7eb;
      --card: #ffffff;
      --accent: #0f766e;
      --accent-soft: #e0f2f1;
      --bg: #f7f8fb;
      font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--ink);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    .shell {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px 80px;
    }
    header {
      padding: 70px 20px 40px;
      background: radial-gradient(circle at 20% 25%, rgba(224, 242, 241, 0.35), transparent 28%), #0f172a; /* soften highlight for mobile comfort */
      color: #f8fafc;
      text-align: left;
    }
    header .shell { padding-bottom: 30px; }
    h1 {
      margin: 0 0 14px;
      font-size: clamp(34px, 4vw, 46px);
      letter-spacing: -0.015em;
      line-height: 1.2;
    }
    .subhead {
      font-size: 1.15rem;
      color: #dbeafe;
      max-width: 680px;
      margin: 0 0 18px;
    }
    .cta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 18px;
      border-radius: 12px;
      border: 1px solid transparent;
      font-weight: 700;
      text-decoration: none;
      cursor: pointer;
    }
    .btn.primary {
      background: #22c55e;
      color: #0f172a;
    }
    .btn.secondary {
      background: transparent;
      border-color: #93c5fd;
      color: #e0f2fe;
    }
    .meta-line {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px;
      color: #cbd5e1;
      font-size: 0.98rem;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #e0f2f1;
      color: #0f766e;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.95rem;
    }
    h2 {
      margin: 0 0 10px;
      font-size: 1.6rem;
      letter-spacing: -0.01em;
    }
    p { margin: 0 0 12px; color: var(--muted); }
    section {
      margin-top: 26px;
      padding: 22px 20px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: 0 16px 44px rgba(15, 23, 42, 0.08);
    }
    .tag {
      display: inline-block;
      padding: 6px 10px;
      background: #e0f2f1;
      color: #0f766e;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .stack { display: grid; gap: 12px; }
    .grid-3 {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    ul { padding-left: 18px; margin: 0; color: var(--muted); }
    .muted { color: var(--muted); }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
    }
    input, select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--line);
      font-size: 1rem;
      font-family: inherit;
      background: #fff;
    }
    .hint {
      font-size: 0.9rem;
      color: var(--muted);
      margin-top: 4px;
    }
    .two-col {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .notice {
      background: #f8fafc;
      border: 1px solid #cbd5e1;
      padding: 12px;
      border-radius: 10px;
      color: var(--muted);
      font-size: 0.95rem;
    }
    .result {
      display: none;
    }
    .result.active {
      display: grid;
      gap: 14px;
    }
    .example {
      background: #f8fafc;
      border: 1px dashed #cbd5e1;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
      color: var(--muted);
    }
    .stat-box {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 14px;
    }
    footer {
      margin-top: 24px;
      text-align: center;
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.5;
    }
    @media (max-width: 640px) {
      header { padding-top: 54px; }
      h1 { font-size: 32px; }
      section { padding: 18px 16px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="shell">
      <div class="tag">CarbonWise</div>
      <h1>Carbon reporting, made simple.</h1>
      <p class="subhead">Calculate your electricity emissions in minutes — no uploads, no accounts, no personal data.</p>
      <p class="subhead">A self-service, plain-English experience — similar to TurboTax, but built for carbon.</p>
      <div class="cta-row">
        <a class="btn primary" href="#calculator">Calculate my carbon footprint</a>
        <a class="btn secondary" href="#how">See how it works</a>
      </div>
      <div class="meta-line">
        <span>Privacy-first • No logins • No bill uploads</span>
        <span>Aligned with GHG Protocol Scope 2 (location-based)</span>
      </div>
    </div>
  </header>

  <div class="shell">
    <section id="problem">
      <h2>Carbon reporting is confusing by design.</h2>
      <p>Endless portals, vague emission factors, and compliance jargon make small teams stall. CarbonWise removes the noise so you can move.</p>
      <p>We ask only what’s necessary, use public factors (EPA/DEFRA), and explain results in plain English.</p>
    </section>

    <section id="how">
      <h2>How CarbonWise works</h2>
      <div class="grid-3">
        <div>
          <strong>1) You enter electricity usage</strong>
          <p class="muted">Country/region, billing month, and kWh. Nothing personal.</p>
        </div>
        <div>
          <strong>2) CarbonWise applies public emission factors</strong>
          <p class="muted">Transparent, government-issued factors (EPA/DEFRA) — no black boxes.</p>
        </div>
        <div>
          <strong>3) You get a clear estimate</strong>
          <p class="muted">Location-based by default, with optional market-based if you opt in.</p>
        </div>
      </div>
    </section>

    <section id="calculator">
      <h2>Calculate your monthly Scope 2 emissions</h2>
      <p class="muted" style="margin-bottom:8px;">Start by telling us who you are so we can speak your language.</p>
      <form id="carbon-form" class="stack">
        <div class="two-col">
          <div>
            <label for="persona">Who are you?</label>
            <select id="persona" name="persona" required>
              <option value="">Select one</option>
              <option value="founder">Founder / operator</option>
              <option value="finance">Finance / accounting</option>
              <option value="advisor">Fractional CFO / advisor</option>
              <option value="other">Other</option>
            </select>
            <div class="hint">We tailor the explanation tone. No personal data stored.</div>
          </div>
          <div>
            <label for="country">Country / region</label>
            <select id="country" name="country" required>
              <option value="">Select country</option>
              <option value="US">United States</option>
              <option value="CA">Canada</option>
              <option value="UK">United Kingdom</option>
              <option value="AU">Australia</option>
              <option value="SG">Singapore</option>
              <option value="NZ">New Zealand</option>
            </select>
            <div class="hint">We match public grid factors; you can adjust later.</div>
          </div>
        </div>
        <div class="two-col">
          <div>
            <label for="month">Billing month</label>
            <select id="month" name="month" required>
              <option value="">Select month</option>
              <option>January</option><option>February</option><option>March</option><option>April</option>
              <option>May</option><option>June</option><option>July</option><option>August</option>
              <option>September</option><option>October</option><option>November</option><option>December</option>
            </select>
            <div class="hint">We calculate one month at a time for clarity.</div>
          </div>
          <div>
            <label for="year">Billing year</label>
            <select id="year" name="year" required></select>
            <div class="hint">We show only years up to the current year; future periods are blocked.</div>
          </div>
        </div>
        <div class="two-col">
          <div>
            <label for="kwh">Electricity used (kWh)</label>
            <input type="number" id="kwh" name="kwh" min="1" step="any" required placeholder="e.g., 1200" />
            <div class="hint">Found on your statement as total kWh for the month.</div>
          </div>
          <div>
            <label for="region">State / region</label>
            <select id="region" name="region" required>
              <option value="">Select state / province</option>
            </select>
            <div class="hint">Choose your state (US) or province/territory (Canada). Used only to contextualize results.</div>
          </div>
        </div>
        <div class="notice">
          No uploads. No accounts. We only use the fields above to calculate a Scope 2 (location-based) estimate with EPA/DEFRA factors. This is informational, not a filing.
        </div>
        <div class="cta-row" style="justify-content:flex-start;">
          <button type="submit" class="btn primary">See my emissions in minutes</button>
        </div>
        <div class="notice" style="margin-top:10px;">
          <label style="display:flex;align-items:center;gap:8px;font-weight:600;">
            <input type="checkbox" id="market-toggle" style="width:auto;" />
            Include market-based Scope 2 (RECs / PPAs)
          </label>
          <div class="hint" style="margin-top:6px;">Market-based emissions reflect purchased renewable energy instruments such as RECs or PPAs. Optional and off by default.</div>
          <div id="market-fields" class="stack" style="margin-top:10px; display:none;">
            <div class="two-col">
              <div>
                <label for="market-type">Instrument type</label>
                <select id="market-type" name="market-type">
                  <option value="">Select instrument</option>
                  <option value="REC">REC</option>
                  <option value="PPA">PPA</option>
                  <option value="Green tariff">Green tariff</option>
                </select>
                <div class="hint">We do not verify certificates or contracts; this is user-declared.</div>
              </div>
              <div>
                <label for="market-kwh">Covered electricity (kWh)</label>
                <input type="number" id="market-kwh" name="market-kwh" min="0" step="any" placeholder="e.g., 500" />
                <div class="hint">Portion of your kWh covered by RECs/PPAs. Uncovered kWh uses location-based factors.</div>
              </div>
            </div>
            <div class="two-col">
              <div>
                <label for="market-year">Reporting year (market-based)</label>
                <select id="market-year" name="market-year"></select>
                <div class="hint">Must be current or past years only.</div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <!-- Trust strip anchors methodology without heavy enterprise vibe -->
      <div class="notice" style="margin-top:10px;">
        <strong>Methodology:</strong> GHG Protocol Scope 2 (location-based) • <strong>Emission factors:</strong> Public, government-issued data (year-stamped) • Estimates only — not legal, tax, or audit advice. Emission factors are updated as new data is released.
      </div>
    </section>

    <section id="results">
      <h2>Your estimate</h2>
      <!-- Pre-calculated example builds trust before interaction -->
      <div class="example">
        <strong>Example:</strong> 1,850 kWh → 1.42 metric tons CO₂e ≈ driving ~3,500 miles. Check your own month below.
      </div>
      <div id="result-container" class="result">
        <div class="grid-3">
          <div class="stat-box">
            <strong id="result-tons">—</strong><br />
            <span class="muted">Location-based (GHG Protocol)</span>
          </div>
          <div class="stat-box">
            <strong id="result-compare">—</strong><br />
            <span class="muted">Real-world comparison</span>
          </div>
          <div class="stat-box">
            <strong id="result-next">—</strong><br />
            <span class="muted">What to do next</span>
          </div>
          <div class="stat-box">
            <strong id="result-market">—</strong><br />
            <span class="muted">Market-based (GHG Protocol)</span>
          </div>
        </div>
        <div class="notice" id="calc-details"></div>
        <p class="muted" id="factor-mismatch" style="display:none;"></p>
        <p class="muted" id="interpretation"></p>
        <p class="muted" id="disclaimer"><strong>Disclaimer:</strong> CarbonWise provides informational estimates only. This is not legal, audit, or tax advice.</p>
        <div class="notice" id="market-disclaimer" style="display:none;">
          <strong>Market-based note:</strong> Market-based emissions depend on contractual instruments and are reported separately from location-based emissions. This estimate is based on user-declared renewable energy instruments. CarbonWise does not verify certificates or contracts and does not provide legal, tax, or audit advice.
          <div id="market-details" class="muted" style="margin-top:6px;"></div>
        </div>
        <div class="notice" id="compliance-helper">
          <strong>Compliance context (plain English):</strong><br />
          California SB-253 / SB-261 and EU CSRD apply to certain larger companies or those operating in those regions. Many small businesses are not required to report yet. This is high-level guidance only — not legal or audit advice.
        </div>
      </div>
      <div id="placeholder" class="muted">Your results will appear here after you calculate.</div>
    </section>

    <section id="privacy">
      <h2>Privacy & trust</h2>
      <ul>
        <li>No uploads. We never ask for bills or PDFs.</li>
        <li>No accounts or logins required to see results.</li>
        <li>No stored personal data. Inputs stay on your device.</li>
        <li>Emission factors from EPA / DEFRA — transparent and explainable.</li>
      </ul>
    </section>

    <section id="vision">
      <h2>CarbonWise is just getting started</h2>
      <p class="muted">We’re building the calm, obvious path to carbon reporting.</p>
      <div class="grid-3">
        <div>
          <strong>Monthly tracking</strong>
          <p class="muted">See trends over time and surface anomalies automatically.</p>
        </div>
        <div>
          <strong>Scope 1 & 2 coverage</strong>
          <p class="muted">Measure direct fuel use and electricity emissions — clearly and simply.</p>
        </div>
        <div>
          <strong>Exportable ESG summaries</strong>
          <p class="muted">Share clean, audit-friendly summaries with stakeholders.</p>
        </div>
      </div>
    </section>

    <footer>
      <p>CarbonWise exists to make carbon reporting obvious, private, and fast.</p>
      <p>Aligned with GHG Protocol Scope 2 (location-based). Factors: EPA / DEFRA.</p>
      <p><a href="mailto:hello@esgrise.com">Contact / feedback</a></p>
    </footer>
  </div>

  <script type="module">
    import { EMISSION_FACTORS, GLOBAL_FALLBACK } from './data/emission-factors.js';
    // Configurable emission factors (metric tons CO2e per kWh)
    // Emission factors imported from a versioned, append-only dataset for easy updates without touching UI/logic.

    // Valid regions to keep entries clean and trusted
    const REGION_OPTIONS = {
      US: [
        "Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia",
        "Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine",
        "Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada",
        "New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma",
        "Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont",
        "Virginia","Washington","West Virginia","Wisconsin","Wyoming"
      ],
      CA: [
        "Alberta","British Columbia","Manitoba","New Brunswick","Newfoundland and Labrador","Northwest Territories",
        "Nova Scotia","Nunavut","Ontario","Prince Edward Island","Quebec","Saskatchewan","Yukon"
      ],
      UK: [
        "England","Northern Ireland","Scotland","Wales"
      ],
      AU: [
        "New South Wales","Victoria","Queensland","Western Australia","South Australia",
        "Tasmania","Australian Capital Territory","Northern Territory"
      ],
      SG: [
        "Singapore"
      ],
      NZ: [
        "Auckland","Bay of Plenty","Canterbury","Gisborne","Hawke's Bay","Manawatu-Whanganui","Marlborough",
        "Nelson","Northland","Otago","Southland","Taranaki","Tasman","Waikato","Wellington","West Coast"
      ]
    };
    const CAR_MILES_PER_TON = 1 / 0.000404; // ~0.404 kg CO2e per mile
    const AVG_HOME_KWH_MONTH = 877; // US average monthly kWh per home

    const form = document.getElementById('carbon-form');
    const countryEl = document.getElementById('country');
    const regionEl = document.getElementById('region');
    const yearEl = document.getElementById('year');
    const monthEl = document.getElementById('month');
    const marketToggleEl = document.getElementById('market-toggle');
    const marketFields = document.getElementById('market-fields');
    const marketTypeEl = document.getElementById('market-type');
    const marketKwhEl = document.getElementById('market-kwh');
    const marketYearEl = document.getElementById('market-year');
    const resultContainer = document.getElementById('result-container');
    const placeholder = document.getElementById('placeholder');
    const tonsEl = document.getElementById('result-tons');
    const compareEl = document.getElementById('result-compare');
    const nextEl = document.getElementById('result-next');
    const calcDetailsEl = document.getElementById('calc-details');
    const interpretationEl = document.getElementById('interpretation');
    const factorMismatchEl = document.getElementById('factor-mismatch');
    const resultMarketEl = document.getElementById('result-market');
    const marketDisclaimer = document.getElementById('market-disclaimer');
    const marketDetails = document.getElementById('market-details');

    const TODAY = new Date();
    const CURRENT_YEAR = TODAY.getFullYear();
    const CURRENT_MONTH = TODAY.getMonth() + 1; // 1-12
    const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];

    const formatNumber = (n, digits = 2) => Number(n).toLocaleString(undefined, { maximumFractionDigits: digits, minimumFractionDigits: digits });

    const normalizeKey = (str) => (str || "").trim().toUpperCase();

    // Populate year dropdown with current year and past years only
    const populateYears = (el) => {
      el.innerHTML = '';
      for (let y = CURRENT_YEAR; y >= 2024; y -= 1) {
        const opt = document.createElement('option');
        opt.value = y;
        opt.textContent = y;
        el.appendChild(opt);
      }
    };

    // Disable future months when current year is selected
    const syncMonthOptions = () => {
      const selectedYear = parseInt(yearEl.value, 10);
      const monthOptions = Array.from(monthEl.options).filter((o) => o.value);
      monthOptions.forEach((opt, idx) => {
        const monthNumber = idx + 1;
        opt.disabled = selectedYear === CURRENT_YEAR && monthNumber > CURRENT_MONTH;
      });
      // If current selection becomes invalid, reset to blank
      if (selectedYear === CURRENT_YEAR) {
        const selMonthIndex = monthEl.selectedIndex;
        const monthNumber = selMonthIndex > 0 ? selMonthIndex : 0;
        if (monthNumber > CURRENT_MONTH) {
          monthEl.value = '';
        }
      }
    };

    const setRegionOptions = (country) => {
      const opts = REGION_OPTIONS[country] || [];
      regionEl.innerHTML = '<option value="">Select state / province</option>';
      opts.forEach((name) => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        regionEl.appendChild(opt);
      });
    };

    // Select a FINAL factor version: prefer billing-year match, else most recent final year. Never overwrite historical records.
    const selectFinalFactor = (records, billingYear) => {
      const finals = (records || []).filter((r) => r.status === 'final');
      if (!finals.length) return null;
      const exact = finals.find((r) => r.year === billingYear);
      if (exact) return exact;
      return finals.reduce((latest, rec) => {
        if (!latest) return rec;
        return rec.year > latest.year ? rec : latest;
      }, null);
    };

    const getEmissionFactor = (country, region) => {
      const countryData = EMISSION_FACTORS[country];
      const regionKey = normalizeKey(region);
      if (countryData?.regions && countryData.regions[regionKey]) {
        const data = selectFinalFactor(countryData.regions[regionKey], parseInt(yearEl.value, 10));
        if (data) return { ...data, regionLabel: `${country} – ${region}` };
      }
      if (countryData?.default) {
        const data = selectFinalFactor(countryData.default, parseInt(yearEl.value, 10));
        if (data) return { ...data, regionLabel: country };
      }
      const fallback = selectFinalFactor(GLOBAL_FALLBACK, parseInt(yearEl.value, 10)) || GLOBAL_FALLBACK[0];
      return { ...fallback, regionLabel: "Global average" };
    };

    countryEl.addEventListener('change', (e) => {
      setRegionOptions(e.target.value);
    });

    yearEl.addEventListener('change', syncMonthOptions);
    marketToggleEl.addEventListener('change', (e) => {
      marketFields.style.display = e.target.checked ? 'grid' : 'none';
    });

    // Initialize dropdowns
    populateYears(yearEl);
    populateYears(marketYearEl);
    syncMonthOptions();
    setRegionOptions('');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const persona = form.persona.value;
      const country = form.country.value || 'OTHER';
      const month = form.month.value;
      const year = parseInt(form.year.value, 10);
      const kwh = parseFloat(form.kwh.value || '0');
      const region = form.region.value.trim();
      const marketEnabled = marketToggleEl.checked;
      const marketType = marketTypeEl.value;
      const marketKwh = parseFloat(marketKwhEl.value || '0');
      const marketYear = parseInt(marketYearEl.value || `${CURRENT_YEAR}`, 10);

      if (!persona || !country || !month || !year || !kwh || kwh <= 0 || !region) {
        alert('Please complete all fields to calculate.');
        return;
      }

      // Validation to block future periods and distinguish current partial periods
      if (year > CURRENT_YEAR) {
        alert('Carbon emissions can only be calculated for past or current periods.');
        return;
      }
      const monthNumber = MONTHS.indexOf(month) + 1; // Jan=1..Dec=12
      if (year === CURRENT_YEAR && monthNumber > CURRENT_MONTH) {
        alert('Future months are not supported. Please select a completed or current billing period.');
        return;
      }

      if (marketEnabled) {
        if (!marketType || Number.isNaN(marketKwh) || marketKwh < 0 || !marketYear) {
          alert('Please provide market-based instrument type, covered kWh, and reporting year.');
          return;
        }
        if (marketYear > CURRENT_YEAR) {
          alert('Carbon emissions can only be calculated for past or current periods.');
          return;
        }
        if (marketKwh > kwh) {
          alert('Covered electricity (kWh) cannot exceed total electricity used.');
          return;
        }
      }

      const factorData = getEmissionFactor(country, region);
      const factor = factorData.factor;
      const tonsLocation = kwh * factor;
      const coveredKwh = marketEnabled ? Math.min(marketKwh, kwh) : 0;
      const uncoveredKwh = Math.max(kwh - coveredKwh, 0);
      const tonsMarket = marketEnabled ? uncoveredKwh * factor : tonsLocation;
      // Keep location-based and market-based as separate values for downstream export/reporting
      const miles = tonsLocation * CAR_MILES_PER_TON;
      const homes = kwh / AVG_HOME_KWH_MONTH;

      tonsEl.textContent = `${formatNumber(tonsLocation, 3)} t CO₂e`;
      compareEl.textContent = `${formatNumber(tonsLocation * CAR_MILES_PER_TON, 0)} car miles or ${formatNumber(homes, 1)} homes for a month`;
      nextEl.textContent = persona === 'finance'
        ? 'Save this number for your monthly close and share with leadership.'
        : persona === 'advisor'
          ? 'Use this as a directional input in your client’s ESG summary.'
          : 'Track this month-over-month to spot reductions and set targets.';
      resultMarketEl.textContent = marketEnabled
        ? `${formatNumber(tonsMarket, 3)} t CO₂e`
        : 'Not provided';

      const factorSentence = `This estimate uses ${factorData.year} ${factorData.source} location-based electricity emission factors for ${factorData.regionLabel} (${formatNumber(factor, 6)} t CO₂e/kWh, version ${factorData.version}).`;
      calcDetailsEl.textContent = factorSentence;

      const isPartialCurrent = year === CURRENT_YEAR && monthNumber === CURRENT_MONTH;
      const partialNote = isPartialCurrent ? ' Partial period estimate: This calculation is based on usage entered for the current month and may change once the billing period is complete.' : '';
      interpretationEl.textContent = `For ${month} ${year} in ${region}, your electricity use generates about ${formatNumber(tonsLocation, 3)} metric tons CO₂e (location-based).${partialNote}`;

      // Show data currency disclaimer when billing year exceeds factor year
      if (year > factorData.year || (marketEnabled && marketYear > factorData.year)) {
        factorMismatchEl.style.display = 'block';
        factorMismatchEl.textContent = 'Emission factors are published with a delay. This calculation uses the most recent available data.';
      } else {
        factorMismatchEl.style.display = 'none';
        factorMismatchEl.textContent = '';
      }

      if (marketEnabled) {
        marketDisclaimer.style.display = 'block';
        marketDetails.textContent = `Instrument: ${marketType} • Covered kWh: ${formatNumber(coveredKwh, 0)} • Reporting year: ${marketYear}. Market-based emissions depend on contractual instruments and are reported separately from location-based emissions.`;
      } else {
        marketDisclaimer.style.display = 'none';
        marketDetails.textContent = '';
      }

      placeholder.style.display = 'none';
      resultContainer.classList.add('active');
      resultContainer.scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
